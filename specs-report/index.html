<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <title>Specs Reporter - Summary</title>
    <style>
        /* Critical CSS for immediate sidebar alignment */
        .nav-item {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
            padding: 15px 20px !important;
            cursor: pointer !important;
            transition: background-color 0.3s ease !important;
            color: #bdc3c7 !important;
            text-decoration: none !important;
            text-align: left !important;
            justify-content: flex-start !important;
        }
        
        .nav-item.active {
            background-color: #3498db !important;
            color: white !important;
        }
        
        .nav-item:hover {
            background-color: #34495e !important;
            color: white !important;
        }
        
        /* Filter section visibility controlled by JavaScript */
        .filter-section {
            display: none;
        }
        
        .filter-section.visible {
            display: block;
        }
        
        /* Hide unnecessary filters on Test Specs page - hide Status, Browser, Tags, and Duration - keep only Search */
        /* Filter groups: nth-child(2) = Search, (3) = Status, (4) = Browser, (5) = Tags, (6) = Duration */
        body.specs-active .filter-section .filter-group:nth-child(3),
        body.specs-active .filter-section .filter-group:nth-child(4),
        body.specs-active .filter-section .filter-group:nth-child(5),
        body.specs-active .filter-section .filter-group:nth-child(6) {
            display: none !important;
        }
        
        /* Show search filter (nth-child(2)) on Test Specs page */
        body.specs-active .filter-section .filter-group:nth-child(2) {
            display: block !important;
        }
        
        /* Show Clear Filters button on Test Specs page */
        body.specs-active .filter-section .filter-actions {
            display: block;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            margin: 0;
            padding: 0;
        }

        /* App Layout */
        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: white;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            color: #bdc3c7;
            text-decoration: none;
            text-align: left;
            justify-content: flex-start;
        }

        .nav-item:hover {
            background-color: #34495e;
            color: white;
        }

        .nav-item.active {
            background-color: #3498db;
            color: white;
        }

        .nav-item .material-symbols-outlined {
            font-size: 20px;
        }

        /* Filter Section */
        .filter-section {
            padding: 20px;
            border-top: 1px solid #34495e;
            background-color: #34495e;
        }

        .filter-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #bdc3c7;
        }

        .filter-header h3 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-header .material-symbols-outlined {
            font-size: 18px;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: #bdc3c7;
            font-weight: 500;
        }

        .filter-group input[type="text"],
        .filter-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #4a5f7a;
            border-radius: 4px;
            background-color: #2c3e50;
            color: white;
            font-size: 0.85rem;
        }

        .filter-group input[type="text"]:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .filter-group input[type="text"]::placeholder {
            color: #7f8c8d;
        }

        /* Multi-select tags styling */
        .filter-group select[multiple] {
            min-height: 100px;
        }

        .filter-mode-toggle {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .filter-mode-toggle label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: #bdc3c7;
        }

        .filter-mode-toggle input[type="radio"] {
            cursor: pointer;
        }

        .filter-mode-toggle input[type="radio"]:checked + span {
            color: #3498db;
            font-weight: 600;
        }

        /* Active tag filters display */
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .active-filter-chip {
            background: #3498db;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .active-filter-chip:hover {
            background: #2980b9;
        }

        .active-filter-chip .material-symbols-outlined {
            font-size: 14px;
        }

        /* Filter Checkboxes */
        .filter-checkboxes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .filter-checkboxes .checkbox-label {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #bdc3c7;
            padding: 4px 0;
        }

        .checkbox-text {
            color: #bdc3c7;
            font-size: 0.85rem;
            user-select: none;
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid #4a5f7a;
            position: relative;
            transition: all 0.3s ease;
            background-color: #2c3e50;
            flex-shrink: 0;
            display: block;
        }

        .checkbox-label:hover .checkmark {
            border-color: #3498db;
            background-color: #34495e;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            border-color: #3498db;
            background-color: #3498db;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .checkmark.passed {
            /* No background color for unchecked state */
        }

        .checkmark.failed {
            /* No background color for unchecked state */
        }

        .checkmark.skipped {
            /* No background color for unchecked state */
        }

        .checkmark.flaky {
            /* No background color for unchecked state */
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark.passed {
            background-color: #27ae60;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark.failed {
            background-color: #e74c3c;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark.skipped {
            background-color: #f39c12;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark.flaky {
            background-color: #9b59b6;
        }

        /* Filter Actions */
        .filter-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #4a5f7a;
        }

        .clear-filters-btn {
            width: 100%;
            padding: 10px 15px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.3s ease;
        }

        .clear-filters-btn:hover {
            background-color: #c0392b;
        }

        .clear-filters-btn .material-symbols-outlined {
            font-size: 16px;
        }

        /* Filtered Elements */
        .filtered-out {
            display: none !important;
        }

        .filter-highlight {
            background-color: rgba(52, 152, 219, 0.1);
            border-left: 3px solid #3498db;
        }

        /* No Results Message */
        .no-results-message {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .no-results-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .no-results-content .material-symbols-outlined {
            font-size: 48px;
            color: #bdc3c7;
            margin-bottom: 20px;
        }

        .no-results-content h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .no-results-content p {
            color: #7f8c8d;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .no-results-content .clear-filters-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s ease;
        }

        .no-results-content .clear-filters-btn:hover {
            background-color: #2980b9;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 2.5rem;
            color: #2c3e50;
        }

        .status-icon {
            font-size: 2rem;
        }

        .status.passed { color: #27ae60; }
        .status.failed { color: #e74c3c; }
        .status.skipped { color: #f39c12; }

        /* Environment Information */
        .environment-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .environment-info h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .environment-info h3 .material-symbols-outlined {
            font-size: 24px;
            color: #3498db;
        }

        .env-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .env-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .env-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .env-value {
            font-size: 1rem;
            color: #2c3e50;
            font-weight: 500;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card.passed .number { color: #27ae60; }
        .stat-card.failed .number { color: #e74c3c; }
        .stat-card.skipped .number { color: #f39c12; }
        .stat-card.total .number { color: #3498db; }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .tag-stats-container {
            margin-bottom: 30px;
        }
        
        .tag-stats-container .stat-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tag-stats-container .stat-card h3 .material-symbols-outlined {
            font-size: 24px;
            color: #3498db;
        }
        
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag-stat-item {
            background: #ecf0f1;
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }
        
        .tag-stat-item .tag-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .tag-stat-item .tag-count {
            background: #3498db;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }

        .test-groups {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .test-group {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
        }

        .test-group h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .test-list {
            list-style: none;
        }

        .test-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            background: white;
            transition: background-color 0.2s;
        }

        .test-item:hover {
            background: #f8f9fa;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-item .material-symbols-outlined {
            flex-shrink: 0;
            font-size: 20px;
        }

        .test-item a {
            text-decoration: none;
            color: #3498db;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .test-item a:hover {
            text-decoration: underline;
        }

        .test-item .test-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .test-item .test-status.passed {
            background: #d5f4e6;
            color: #27ae60;
        }

        .test-item .test-status.failed {
            background: #fadbd8;
            color: #e74c3c;
        }

        .test-item .test-status.skipped {
            background: #fef9e7;
            color: #f39c12;
        }

        /* Tests page specific styling */
        #tests-content .test-item {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
            padding: 6px 12px !important;
            border-bottom: 1px solid #ecf0f1 !important;
            background: white !important;
            transition: background-color 0.2s !important;
            flex-direction: row !important;
            min-height: 40px !important;
        }
        
        /* Hide filtered test items */
        #tests-content .test-item.filtered-out {
            display: none !important;
        }

        #tests-content .test-item:hover {
            background: #f8f9fa !important;
        }

        #tests-content .test-item:last-child {
            border-bottom: none !important;
        }

        #tests-content .test-item .material-symbols-outlined {
            flex-shrink: 0 !important;
            font-size: 20px !important;
        }

        #tests-content .test-item a {
            text-decoration: none !important;
            color: #3498db !important;
            flex: 1 !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }

        #tests-content .test-item a:hover {
            text-decoration: underline !important;
        }

        #tests-content .test-item .test-status {
            padding: 4px 8px !important;
            border-radius: 4px !important;
            font-size: 0.75rem !important;
            font-weight: bold !important;
            text-transform: uppercase !important;
            flex-shrink: 0 !important;
        }

        #tests-content .test-item .test-status.passed {
            background: #d5f4e6 !important;
            color: #27ae60 !important;
        }

        #tests-content .test-item .test-status.failed {
            background: #fadbd8 !important;
            color: #e74c3c !important;
        }

        #tests-content .test-item .test-status.skipped {
            background: #fef9e7 !important;
            color: #f39c12 !important;
        }

        #tests-content .test-item > span:last-child {
            flex-shrink: 0 !important;
            color: #7f8c8d !important;
            font-size: 0.85rem !important;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 10px;
            }
            
            .mobile-menu-btn {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: #2c3e50;
                color: white;
                border: none;
                padding: 10px;
                border-radius: 5px;
                cursor: pointer;
            }
            
            .filter-section {
                padding: 15px;
            }
            
            .filter-group {
                margin-bottom: 15px;
            }
            
            .filter-checkboxes {
                gap: 6px;
            }
            
            .checkbox-label {
                font-size: 0.8rem;
            }
            
            .clear-filters-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .environment-info .env-details {
                grid-template-columns: 1fr;
            }
        }

        .mobile-menu-btn {
            display: none;
        }

        /* Test Detail Styles */
        .test-detail-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .back-button:hover {
            background: #2980b9;
        }

        .back-button .material-symbols-outlined {
            font-size: 18px;
        }

        #test-detail-body {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Test Specs Styling */
        .test-specs-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .test-specs-header h2 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }

        .test-specs-header p {
            margin: 0;
            color: #7f8c8d;
            font-size: 14px;
        }

        .specs-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .spec-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .spec-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .spec-header {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .spec-name {
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }

        .spec-count {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-left: auto;
        }

        .spec-summary {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-badge.passed {
            background-color: #d4edda;
            color: #155724;
        }

        .status-badge.failed {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-badge.skipped {
            background-color: #fff3cd;
            color: #856404;
        }

        /* Spec Tests View */
        .spec-tests-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background: #2980b9;
        }

        #spec-tests-title {
            margin: 0;
            color: #2c3e50;
        }

        .tests-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .test-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 80px;
        }

        .test-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .test-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 8px;
        }

        .test-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .test-status.status-passed {
            background-color: #d4edda;
            color: #155724;
        }

        .test-status.status-failed {
            background-color: #f8d7da;
            color: #721c24;
        }

        .test-status.status-skipped {
            background-color: #fff3cd;
            color: #856404;
        }

        .test-title {
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }

        .test-duration {
            color: #7f8c8d;
            font-size: 14px;
        }

        .test-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .test-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .copy-prompt-icon {
            padding: 6px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            margin-right: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            position: relative;
        }

        .copy-prompt-icon:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .copy-prompt-icon .material-symbols-outlined {
            font-size: 18px;
        }

        .test-actions {
            display: flex;
            gap: 4px;
            margin-top: 6px;
            justify-content: flex-end;
        }

        /* Settings Section Styles */
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .setting-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-header {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .setting-header .material-symbols-outlined {
            font-size: 32px;
            color: #3498db;
        }

        .setting-header h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .setting-header p {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .slider:hover {
            background-color: #b3b3b3;
        }

        input:checked + .slider:hover {
            background-color: #2980b9;
        }

        /* Hide media sections when toggled off */
        .hide-videos video,
        .hide-videos .media-item:has(video) {
            display: none;
        }

        .hide-screenshots img,
        .hide-screenshots .media-item:has(img) {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <span class="material-symbols-outlined">menu</span>
    </button>

    <div class="app-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Specs Reporter</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <span class="material-symbols-outlined">dashboard</span>
                    Dashboard
                </a>
                <a href="#" class="nav-item" onclick="showSection('specs')">
                    <span class="material-symbols-outlined">description</span>
                    Test Specs
                </a>
                <a href="#" class="nav-item" onclick="showSection('tests')">
                    <span class="material-symbols-outlined">list</span>
                    Tests
                </a>
                <a href="#" class="nav-item" onclick="showSection('settings')">
                    <span class="material-symbols-outlined">settings</span>
                    Settings
                </a>
            </nav>
            
            <!-- Filter Controls -->
            <div class="filter-section">
                <div class="filter-header">
                    <span class="material-symbols-outlined">filter_list</span>
                    <h3>Filters</h3>
                </div>
                
                <!-- Search -->
                <div class="filter-group">
                    <label for="search-input">Search Tests</label>
                    <input type="text" id="search-input" placeholder="Search by title, tags..." oninput="applyFilters()">
                </div>
                
                <!-- Status Filter -->
                <div class="filter-group">
                    <label>Status</label>
                    <div class="filter-checkboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter-passed" checked onchange="applyFilters()">
                            <span class="checkmark passed"></span>
                            <span class="checkbox-text">Passed</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter-failed" checked onchange="applyFilters()">
                            <span class="checkmark failed"></span>
                            <span class="checkbox-text">Failed</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter-skipped" checked onchange="applyFilters()">
                            <span class="checkmark skipped"></span>
                            <span class="checkbox-text">Skipped</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="filter-flaky" checked onchange="applyFilters()">
                            <span class="checkmark flaky"></span>
                            <span class="checkbox-text">Flaky</span>
                        </label>
                    </div>
                </div>
                
                <!-- Browser Filter -->
                <div class="filter-group">
                    <label>Browser</label>
                    <select id="browser-filter" onchange="applyFilters()">
                        <option value="">All Browsers</option>
                    </select>
                </div>
                
                <!-- Tags Filter -->
                <div class="filter-group">
                    <label>Tags</label>
                    <select id="tags-filter" multiple size="4" onchange="applyFilters()">
                        <option value="">All Tags</option>
                    </select>
                    <div class="filter-mode-toggle">
                        <label>
                            <input type="radio" name="tag-filter-mode" value="AND" checked onchange="applyFilters()">
                            <span>AND (all selected)</span>
                        </label>
                        <label>
                            <input type="radio" name="tag-filter-mode" value="OR" onchange="applyFilters()">
                            <span>OR (any selected)</span>
                        </label>
                    </div>
                    <div class="active-filters" id="active-tag-filters"></div>
                </div>
                
                <!-- Duration Filter -->
                <div class="filter-group">
                    <label>Duration</label>
                    <select id="duration-filter" onchange="applyFilters()">
                        <option value="">All Durations</option>
                        <option value="fast">Fast (&lt; 1s)</option>
                        <option value="medium">Medium (1-5s)</option>
                        <option value="slow">Slow (&gt; 5s)</option>
                    </select>
                </div>
                
                <!-- Clear Filters -->
                <div class="filter-actions">
                    <button class="clear-filters-btn" onclick="clearFilters()">
                        <span class="material-symbols-outlined">clear</span>
                        Clear Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container">
                <!-- Dashboard Section -->
                <div id="dashboard-content" class="content-section active">
                    <div class="header">
                        <h1>
                            Specs Reporter
                        </h1>
                        <p><strong>Duration:</strong> 489ms</p>
                        <p><strong>Generated:</strong> 10/28/2025, 10:44:50 AM</p>
                    </div>

                    
                    <div class="environment-info">
                        <h3><span class="material-symbols-outlined">computer</span> Environment Information</h3>
                        <div class="env-details">
                            <div class="env-item">
                                <span class="env-label">Operating System:</span>
                                <span class="env-value">Windows</span>
                            </div>
                            <div class="env-item">
                                <span class="env-label">Node Version:</span>
                                <span class="env-value">v22.19.0</span>
                            </div>
                            <div class="env-item">
                                <span class="env-label">Playwright Version:</span>
                                <span class="env-value">1.56.1</span>
                            </div>
                            
                            <div class="env-item">
                                <span class="env-label">Browsers:</span>
                                <span class="env-value">Chrome, Edge, Safari/WebKit, Chrome (Mobile)</span>
                            </div>
                            
                        </div>
                    </div>
                    

                    <div class="summary-stats">
                        <div class="stat-card total">
                            <h3>Total Tests</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="stat-card passed">
                            <h3>Passed</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="stat-card failed">
                            <h3>Failed</h3>
                            <div class="number">0</div>
                        </div>
                        <div class="stat-card skipped">
                            <h3>Skipped</h3>
                            <div class="number">0</div>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>Test Results Distribution</h3>
                            <div id="pieChart"></div>
                        </div>
                        <div class="chart-card">
                            <h3>Top 10 Longest Tests</h3>
                            <div id="barChart"></div>
                        </div>
                    </div>
                    
                    <!-- Tag Statistics -->
                    <div class="tag-stats-container">
                        <div class="stat-card">
                            <h3>
                                <span class="material-symbols-outlined">label</span>
                                Tag Statistics
                            </h3>
                            <div id="tag-stats"></div>
                        </div>
                    </div>
                </div>

                <!-- Test Specs Section -->
                <div id="specs-content" class="content-section">
                    <div class="test-specs-header">
                        <h2>Test Specifications</h2>
                        <p>Click on a spec to view its tests</p>
                    </div>
                    
                    <div class="specs-list">
                        
                    </div>
                </div>

                <!-- Spec Tests Section -->
                <div id="spec-tests-content" class="content-section">
                    <div class="spec-tests-header">
                        <button class="back-button" onclick="showSection('specs')">
                            <span class="material-symbols-outlined">arrow_back</span>
                            Back to Specs
                        </button>
                        <h2 id="spec-tests-title">Spec Tests</h2>
                    </div>
                    
                    <div id="spec-tests-list" class="tests-list">
                        <!-- Dynamically populated with tests from selected spec -->
                    </div>
                </div>

                <!-- Tests Section -->
                <div id="tests-content" class="content-section">
                    <div class="test-groups">
                        <h2>Test Results by File</h2>
                        
                    </div>
                </div>

                <!-- Test Detail Section -->
                <div id="test-detail-content" class="content-section">
                    <div class="test-detail-header">
                        <button onclick="showSection('tests')" class="back-button">
                            <span class="material-symbols-outlined">arrow_back</span>
                            Back to Tests
                        </button>
                        <h2 id="test-detail-title">Test Details</h2>
                    </div>
                    <div id="test-detail-body">
                        <!-- Test details will be loaded here -->
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-content" class="content-section">
                    <div class="header">
                        <h1>Settings</h1>
                        <p>Configure report display preferences</p>
                    </div>

                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-header">
                                <span class="material-symbols-outlined">videocam</span>
                                <div>
                                    <h3>Videos</h3>
                                    <p>Show or hide video recordings in test details</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-videos" checked onchange="updateMediaSettings()">
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <span class="material-symbols-outlined">image</span>
                                <div>
                                    <h3>Screenshots</h3>
                                    <p>Show or hide screenshots in test details</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-screenshots" checked onchange="updateMediaSettings()">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global object to store prompt data for all tests
        window.testPrompts = {
            
        };

        // Enhanced global test data structure for Test Specs
        window.testData = {
            groupedResults: {
                
            }
        };

        // Filtering System
        let currentFilters = {
            search: '',
            status: ['passed', 'failed', 'skipped', 'flaky'],
            browser: '',
            tags: [],
            tagMode: 'AND',
            duration: ''
        };
        
        // Flag to prevent initial filtering
        let filtersInitialized = false;

        // Initialize filter options
        function initializeFilters() {
            // Populate browser options
            const browsers = new Set();
            const tags = new Set();
            
            Object.values(window.testData.groupedResults).forEach(tests => {
                tests.forEach(test => {
                    browsers.add(test.browser);
                    // Extract tags from test data - tags are stored as an array
                    if (test.tags && Array.isArray(test.tags)) {
                        test.tags.forEach(tag => tags.add(tag));
                    }
                });
            });

            const browserSelect = document.getElementById('browser-filter');
            const tagsSelect = document.getElementById('tags-filter');
            
            // Clear existing options first
            browserSelect.innerHTML = '<option value="">All Browsers</option>';
            tagsSelect.innerHTML = '<option value="">All Tags</option>';
            
            browsers.forEach(browser => {
                const option = document.createElement('option');
                option.value = browser;
                option.textContent = browser;
                browserSelect.appendChild(option);
            });

            tags.forEach(tag => {
                const option = document.createElement('option');
                option.value = tag;
                option.textContent = '@' + tag; // Display with @ prefix for clarity
                tagsSelect.appendChild(option);
            });
            
            // Load saved filters from localStorage
            loadFiltersFromStorage();
            
            // Mark filters as initialized
            filtersInitialized = true;
            console.log('Filters initialized, ready to apply');
        }
        
        // Save filters to localStorage
        function saveFiltersToStorage() {
            const filtersToSave = {
                search: currentFilters.search,
                status: currentFilters.status,
                browser: currentFilters.browser,
                tags: currentFilters.tags,
                tagMode: currentFilters.tagMode,
                duration: currentFilters.duration
            };
            localStorage.setItem('specs-filters', JSON.stringify(filtersToSave));
        }
        
        // Load filters from localStorage
        function loadFiltersFromStorage() {
            const savedFilters = localStorage.getItem('specs-filters');
            if (savedFilters) {
                try {
                    const parsed = JSON.parse(savedFilters);
                    
                    // Restore search
                    if (parsed.search) {
                        document.getElementById('search-input').value = parsed.search;
                        currentFilters.search = parsed.search;
                    }
                    
                    // Restore status checkboxes
                    if (parsed.status && Array.isArray(parsed.status)) {
                        currentFilters.status = parsed.status;
                        ['passed', 'failed', 'skipped', 'flaky'].forEach(status => {
                            const checkbox = document.getElementById(`filter-${status}`);
                            if (checkbox) {
                                checkbox.checked = parsed.status.includes(status);
                            }
                        });
                    }
                    
                    // Restore browser
                    if (parsed.browser) {
                        document.getElementById('browser-filter').value = parsed.browser;
                        currentFilters.browser = parsed.browser;
                    }
                    
                    // Restore tags (multi-select)
                    if (parsed.tags && Array.isArray(parsed.tags)) {
                        currentFilters.tags = parsed.tags;
                        parsed.tags.forEach(tag => {
                            const options = Array.from(document.getElementById('tags-filter').options);
                            const optionToSelect = options.find(opt => opt.value === tag);
                            if (optionToSelect) {
                                optionToSelect.selected = true;
                            }
                        });
                    }
                    
                    // Restore tag mode
                    if (parsed.tagMode) {
                        currentFilters.tagMode = parsed.tagMode;
                        document.querySelector(`input[name="tag-filter-mode"][value="${parsed.tagMode}"]`).checked = true;
                    }
                    
                    // Restore duration
                    if (parsed.duration) {
                        document.getElementById('duration-filter').value = parsed.duration;
                        currentFilters.duration = parsed.duration;
                    }
                    
                    console.log('Filters loaded from localStorage:', parsed);
                } catch (e) {
                    console.error('Error loading filters from localStorage:', e);
                }
            }
        }

        // Apply filters to all sections
        function applyFilters() {
            // Don't apply filters until initialization is complete
            if (!filtersInitialized) {
                console.log('Filters not yet initialized, skipping applyFilters');
                return;
            }
            
            // Get current filter values
            currentFilters.search = document.getElementById('search-input').value.toLowerCase();
            currentFilters.browser = document.getElementById('browser-filter').value;
            
            // Get selected tags (multi-select)
            const tagsSelect = document.getElementById('tags-filter');
            currentFilters.tags = Array.from(tagsSelect.selectedOptions)
                .filter(option => option.value !== '')
                .map(option => option.value);
            
            // Get tag filter mode (AND/OR)
            currentFilters.tagMode = document.querySelector('input[name="tag-filter-mode"]:checked').value;
            
            currentFilters.duration = document.getElementById('duration-filter').value;
            
            // Update active tag filters display
            updateActiveTagFilters();
            
            // Get selected statuses
            currentFilters.status = [];
            ['passed', 'failed', 'skipped', 'flaky'].forEach(status => {
                if (document.getElementById(`filter-${status}`).checked) {
                    currentFilters.status.push(status);
                }
            });
            
            // Save filters to localStorage
            saveFiltersToStorage();

            // Apply filters to all sections
            filterDashboard();
            filterTestSpecs();
            filterTests();
            filterSpecTests();
        }

        // Filter dashboard elements
        function filterDashboard() {
            // Dashboard doesn't need filtering as it shows summary stats
            // But we could highlight filtered results if needed
        }

        // Filter test specs
        function filterTestSpecs() {
            const specItems = document.querySelectorAll('.spec-item');
            specItems.forEach(item => {
                const specName = item.querySelector('.spec-name').textContent.toLowerCase();
                const specTests = item.querySelectorAll('.test-item');
                
                let hasVisibleTests = false;
                specTests.forEach(testItem => {
                    if (matchesFilters(testItem)) {
                        testItem.classList.remove('filtered-out');
                        hasVisibleTests = true;
                    } else {
                        testItem.classList.add('filtered-out');
                    }
                });
                
                // Show/hide spec based on visible tests OR if search matches spec name
                const specMatchesSearch = currentFilters.search === '' || specName.includes(currentFilters.search);
                if (hasVisibleTests || specMatchesSearch) {
                    item.classList.remove('filtered-out');
                } else {
                    item.classList.add('filtered-out');
                }
            });
            
            // Show "no results" message if all specs are filtered out
            showNoResultsMessage('specs-content', '.spec-item');
        }

        // Filter tests section
        function filterTests() {
            console.log('filterTests called');
            console.log('Current filters:', currentFilters);
            console.log('Search value:', document.getElementById('search-input').value);
            console.log('Status checkboxes:', {
                passed: document.getElementById('filter-passed').checked,
                failed: document.getElementById('filter-failed').checked,
                skipped: document.getElementById('filter-skipped').checked,
                flaky: document.getElementById('filter-flaky').checked
            });
            const testItems = document.querySelectorAll('#tests-content .test-item');
            console.log('Found test items:', testItems.length);
            testItems.forEach(item => {
                const matches = matchesFiltersForTestsSection(item);
                console.log('Item matches filters:', matches, item);
                if (matches) {
                    item.classList.remove('filtered-out');
                } else {
                    item.classList.add('filtered-out');
                }
            });
            
            // Show "no results" message if all tests are filtered out
            showNoResultsMessage('tests-content', '.test-item');
        }

        // Filter spec tests (when viewing tests within a spec)
        function filterSpecTests() {
            const specTestItems = document.querySelectorAll('#spec-tests-list .test-item');
            specTestItems.forEach(item => {
                // For spec tests, only filter by status, browser, tags, duration - NOT by search
                // Search filter is only for filtering the specs list itself
                const title = item.querySelector('.test-title')?.textContent || '';
                const statusElement = item.querySelector('.test-status');
                const status = statusElement?.textContent.toLowerCase() || '';
                const browserElement = item.querySelector('.test-browser');
                const browser = browserElement?.textContent.toLowerCase() || '';
                
                let shouldShow = true;
                
                // Status filter
                if (currentFilters.status.length > 0 && !currentFilters.status.includes(status)) {
                    shouldShow = false;
                }
                
                // Browser filter
                if (currentFilters.browser && !browser.includes(currentFilters.browser.toLowerCase())) {
                    shouldShow = false;
                }
                
                // Don't apply search filter to spec tests - search is only for finding specs
                
                if (shouldShow) {
                    item.classList.remove('filtered-out');
                } else {
                    item.classList.add('filtered-out');
                }
            });
            
            // Show "no results" message if all spec tests are filtered out
            showNoResultsMessage('spec-tests-content', '#spec-tests-list .test-item');
        }

        // Show "no results" message when filters return no results
        function showNoResultsMessage(containerId, itemSelector) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // Remove existing no-results message
            const existingMessage = container.querySelector('.no-results-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Count visible items
            const visibleItems = container.querySelectorAll(`${itemSelector}:not(.filtered-out)`);
            
            // If no visible items and there are filters active, show message
            if (visibleItems.length === 0 && hasActiveFilters()) {
                const noResultsDiv = document.createElement('div');
                noResultsDiv.className = 'no-results-message';
                noResultsDiv.innerHTML = `
                    <div class="no-results-content">
                        <span class="material-symbols-outlined">search_off</span>
                        <h3>No Results Found</h3>
                        <p>No tests match your current filters. Try adjusting your search criteria.</p>
                        <button class="clear-filters-btn" onclick="clearFilters()">
                            <span class="material-symbols-outlined">clear</span>
                            Clear Filters
                        </button>
                    </div>
                `;
                
                // Insert at the beginning of the container
                container.insertBefore(noResultsDiv, container.firstChild);
                
                // Also hide test groups when no results found
                if (containerId === 'tests-content') {
                    const testGroups = container.querySelectorAll('.test-group');
                    testGroups.forEach(group => group.style.display = 'none');
                }
            } else {
                // Show test groups when results are found
                if (containerId === 'tests-content') {
                    const testGroups = container.querySelectorAll('.test-group');
                    testGroups.forEach(group => group.style.display = 'block');
                }
            }
        }
        
        // Check if any filters are active
        function hasActiveFilters() {
            return currentFilters.search !== '' ||
                   currentFilters.browser !== '' ||
                   (currentFilters.tags && currentFilters.tags.length > 0) ||
                   currentFilters.duration !== '' ||
                   currentFilters.status.length < 4; // Less than all 4 statuses selected
        }
        
        // Update active tag filters display
        function updateActiveTagFilters() {
            const activeFiltersDiv = document.getElementById('active-tag-filters');
            activeFiltersDiv.innerHTML = ''; // Clear existing chips
            
            if (currentFilters.tags && currentFilters.tags.length > 0) {
                currentFilters.tags.forEach(tag => {
                    const chip = document.createElement('div');
                    chip.className = 'active-filter-chip';
                    chip.innerHTML = `
                        @${tag}
                        <span class="material-symbols-outlined" onclick="removeTagFilter('${tag}', event)">close</span>
                    `;
                    activeFiltersDiv.appendChild(chip);
                });
            }
        }
        
        // Remove a tag filter
        function removeTagFilter(tag, event) {
            event.stopPropagation();
            const tagsSelect = document.getElementById('tags-filter');
            const options = Array.from(tagsSelect.options);
            const optionToDeselect = options.find(opt => opt.value === tag);
            if (optionToDeselect) {
                optionToDeselect.selected = false;
                applyFilters();
            }
        }

        // Check if a test item matches current filters (for Test Specs section)
        function matchesFilters(testItem) {
            const title = testItem.querySelector('.test-title')?.textContent.toLowerCase() || '';
            const status = testItem.querySelector('.test-status')?.textContent.toLowerCase() || '';
            const browser = testItem.querySelector('.test-meta')?.textContent.toLowerCase() || '';
            const duration = testItem.querySelector('.test-duration')?.textContent || '';
            
            // Search filter - look for search term in title
            if (currentFilters.search && !title.includes(currentFilters.search)) {
                return false;
            }
            
            // Status filter - if no statuses selected, show no tests
            if (currentFilters.status.length === 0) {
                return false;
            }
            if (!currentFilters.status.includes(status)) {
                return false;
            }
            
            // Browser filter
            if (currentFilters.browser && !browser.includes(currentFilters.browser.toLowerCase())) {
                return false;
            }
            
            // Tags filter - check if test has the selected tag
            if (currentFilters.tags) {
                // Get test number to look up tags in window.testData
                const testNum = testItem.querySelector('.test-header')?.getAttribute('onclick')?.match(/showTestDetail\('(\d+)'\)/)?.[1];
                if (testNum) {
                    const testData = Object.values(window.testData.groupedResults).flat().find(t => t.num === testNum);
                    if (testData && testData.tags) {
                        // Tags are stored without @ prefix in testData
                        if (!testData.tags.includes(currentFilters.tags)) {
                            return false;
                        }
                    } else {
                        return false; // No tags data, exclude
                    }
                } else {
                    return false; // Can't find test number, exclude
                }
            }
            
            // Duration filter
            if (currentFilters.duration) {
                const durationMs = parseDuration(duration);
                switch (currentFilters.duration) {
                    case 'fast':
                        if (durationMs >= 1000) return false;
                        break;
                    case 'medium':
                        if (durationMs < 1000 || durationMs > 5000) return false;
                        break;
                    case 'slow':
                        if (durationMs <= 5000) return false;
                        break;
                }
            }
            
            return true;
        }

        // Check if a test item matches current filters (for Tests section)
        function matchesFiltersForTestsSection(testItem) {
            // For Tests section, test title is in an <a> tag
            const title = testItem.querySelector('a')?.textContent.toLowerCase() || '';
            
            // Status is determined by the test-status class
            let status = '';
            const statusElement = testItem.querySelector('.test-status');
            if (statusElement) {
                // Check for status class names
                if (statusElement.classList.contains('passed')) status = 'passed';
                else if (statusElement.classList.contains('failed')) status = 'failed';
                else if (statusElement.classList.contains('skipped')) status = 'skipped';
                else if (statusElement.classList.contains('flaky')) status = 'flaky';
                // If no class match, try to get from text content
                if (!status && statusElement.textContent) {
                    status = statusElement.textContent.toLowerCase().trim();
                }
            }
            
            // Get test number from the onclick attribute
            const testNum = testItem.querySelector('a')?.getAttribute('onclick')?.match(/showTestDetail\('(\d+)'\)/)?.[1];
            
            console.log('Testing item:', {
                title: title,
                status: status,
                testNum: testNum,
                currentFilters: currentFilters
            });
            
            // Search filter - look for search term in title
            if (currentFilters.search && !title.includes(currentFilters.search)) {
                console.log('Failed search filter:', currentFilters.search, 'not in', title);
                return false;
            }
            
            // Status filter - if no statuses selected, show no tests
            if (currentFilters.status.length === 0) {
                console.log('Failed status filter: no statuses selected');
                return false;
            }
            if (!currentFilters.status.includes(status)) {
                console.log('Failed status filter:', status, 'not in', currentFilters.status);
                return false;
            }
            
            // Tags filter - check if test has the selected tags (multi-select with AND/OR logic)
            if (currentFilters.tags && currentFilters.tags.length > 0) {
                // For Tests section, we need to get tags from window.testData
                if (testNum && window.testData) {
                    const testData = Object.values(window.testData.groupedResults).flat().find(t => t.num === testNum);
                    if (testData && testData.tags && Array.isArray(testData.tags)) {
                        if (currentFilters.tagMode === 'AND') {
                            // Test must have ALL selected tags
                            const hasAllTags = currentFilters.tags.every(tag => testData.tags.includes(tag));
                            if (!hasAllTags) {
                                console.log('Failed AND tags filter: test does not have all tags', testData.tags, 'vs', currentFilters.tags);
                                return false;
                            }
                        } else {
                            // OR mode: test must have ANY of the selected tags
                            const hasAnyTag = currentFilters.tags.some(tag => testData.tags.includes(tag));
                            if (!hasAnyTag) {
                                console.log('Failed OR tags filter: test has none of the selected tags', testData.tags, 'vs', currentFilters.tags);
                                return false;
                            }
                        }
                    } else {
                        console.log('Failed tags filter: no tags data');
                        return false;
                    }
                } else {
                    console.log('Failed tags filter: no testNum or testData');
                    return false;
                }
            }
            
            // Browser filter
            if (currentFilters.browser && currentFilters.browser !== '') {
                if (testNum && window.testData) {
                    const testData = Object.values(window.testData.groupedResults).flat().find(t => t.num === testNum);
                    if (testData && testData.browser !== currentFilters.browser) {
                        console.log('Failed browser filter:', testData.browser, '!=', currentFilters.browser);
                        return false;
                    }
                } else {
                    console.log('Failed browser filter: no testNum or testData');
                    return false;
                }
            }
            
            // Duration filter
            if (currentFilters.duration && currentFilters.duration !== '') {
                if (testNum && window.testData) {
                    const testData = Object.values(window.testData.groupedResults).flat().find(t => t.num === testNum);
                    if (testData && testData.duration) {
                        const durationMs = parseDuration(testData.duration);
                        let shouldExclude = false;
                        switch (currentFilters.duration) {
                            case 'fast':
                                if (durationMs >= 1000) shouldExclude = true;
                                break;
                            case 'medium':
                                if (durationMs < 1000 || durationMs > 5000) shouldExclude = true;
                                break;
                            case 'slow':
                                if (durationMs <= 5000) shouldExclude = true;
                                break;
                        }
                        if (shouldExclude) {
                            console.log('Failed duration filter:', currentFilters.duration, 'durationMs:', durationMs);
                            return false;
                        }
                    }
                } else {
                    console.log('Failed duration filter: no testNum or testData');
                    return false;
                }
            }
            
            console.log('Item passed all filters');
            return true;
        }

        // Parse duration string to milliseconds
        function parseDuration(durationStr) {
            const match = durationStr.match(/(\d+)s\s*(\d+)ms/);
            if (match) {
                return parseInt(match[1]) * 1000 + parseInt(match[2]);
            }
            const secondsMatch = durationStr.match(/(\d+)s/);
            if (secondsMatch) {
                return parseInt(secondsMatch[1]) * 1000;
            }
            const msMatch = durationStr.match(/(\d+)ms/);
            if (msMatch) {
                return parseInt(msMatch[1]);
            }
            return 0;
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('browser-filter').value = '';
            
            // Clear all selected tags
            const tagsSelect = document.getElementById('tags-filter');
            Array.from(tagsSelect.selectedOptions).forEach(option => option.selected = false);
            
            document.getElementById('duration-filter').value = '';
            
            // Check all status checkboxes
            ['passed', 'failed', 'skipped', 'flaky'].forEach(status => {
                document.getElementById(`filter-${status}`).checked = true;
            });
            
            // Reset filter mode to AND
            document.querySelector('input[name="tag-filter-mode"][value="AND"]').checked = true;
            
            // Clear localStorage
            localStorage.removeItem('specs-filters');
            
            // Reset filter state
            currentFilters = {
                search: '',
                status: ['passed', 'failed', 'skipped', 'flaky'],
                browser: '',
                tags: '',
                duration: ''
            };
            
            // Remove all filtered-out classes
            document.querySelectorAll('.filtered-out').forEach(item => {
                item.classList.remove('filtered-out');
            });
        }

        // Sidebar Navigation Functions
        function showSection(sectionName) {
            console.log('showSection called with:', sectionName);
            
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-content');
            console.log('Target section:', targetSection);
            
            if (targetSection) {
                targetSection.classList.add('active');
                console.log('Section activated:', sectionName);
            } else {
                console.error('Section not found:', sectionName + '-content');
            }
            
            // Update active navigation state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked nav item
            const activeNavItem = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
            
            // Show/hide filter section based on page
            const filterSection = document.querySelector('.filter-section');
            console.log('Filter section found:', filterSection);
            console.log('Section name:', sectionName);
            
            // Remove all body classes first
            document.body.classList.remove('specs-active', 'tests-active', 'dashboard-active');
            
            if (filterSection) {
                if (sectionName === 'dashboard') {
                    filterSection.classList.remove('visible');
                    document.body.classList.add('dashboard-active');
                    console.log('Dashboard: Removed visible class');
                } else if (sectionName === 'specs') {
                    // Count the number of specs
                    const specsCount = Object.keys(window.testData?.groupedResults || {}).length;
                    
                    // Hide filters if there's only 1 spec
                    if (specsCount === 1) {
                        filterSection.classList.remove('visible');
                        console.log('Specs: Removed visible class (only 1 spec)');
                    } else {
                        filterSection.classList.add('visible');
                        console.log('Specs: Added visible class and specs-active body class');
                    }
                    document.body.classList.add('specs-active');
                    console.log('Body classes:', document.body.className);
                    console.log('Filter groups:', document.querySelectorAll('.filter-group').length);
                } else if (sectionName === 'tests') {
                    filterSection.classList.add('visible');
                    document.body.classList.add('tests-active');
                    console.log('Tests: Added visible class and tests-active body class');
                } else if (sectionName === 'spec-tests') {
                    filterSection.classList.add('visible');
                    document.body.classList.add('tests-active');
                    console.log('Spec Tests: Added visible class');
                } else if (sectionName === 'settings') {
                    filterSection.classList.remove('visible');
                    document.body.classList.add('settings-active');
                    console.log('Settings: Removed visible class');
                }
            } else {
                console.error('Filter section not found!');
            }
            
            // Apply filters to the newly shown section (skip for settings)
            if (sectionName !== 'settings') {
                setTimeout(() => {
                    applyFilters();
                }, 100);
            }
            
            // Update URL hash
            window.location.hash = sectionName;
            
            // Close mobile sidebar if open
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        // Test Specs Functions
        function showSpecTests(fileName) {
            // Hide specs list, show spec tests
            document.getElementById('specs-content').classList.remove('active');
            document.getElementById('spec-tests-content').classList.add('active');
            
            // Update title
            document.getElementById('spec-tests-title').textContent = `Tests in ${fileName}`;
            
            // Populate tests list
            populateSpecTests(fileName);
            
            // Apply current filters to the newly displayed tests
            setTimeout(() => {
                filterSpecTests();
            }, 100);
            
            // Update URL hash
            window.location.hash = `spec-${encodeURIComponent(fileName)}`;
            
            // Close mobile sidebar if open
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        function populateSpecTests(fileName) {
            const testsList = document.getElementById('spec-tests-list');
            
            const specTests = window.testData.groupedResults[fileName];
            
            if (!specTests) {
                testsList.innerHTML = '<p>No tests found for this spec.</p>';
                return;
            }
            
            let html = '';
            specTests.forEach(test => {
                html += `
                    <div class="test-item" onclick="showTestDetail('${test.num}')">
                        <div class="test-header">
                            <span class="test-status status-${test.status}">${test.status}</span>
                            <span class="test-title">${test.title}</span>
                            <span class="test-duration">${test.duration}</span>
                        </div>
                        <div class="test-meta">
                            <span class="test-browser">${test.browser}</span>
                            <span class="test-file">${test.fileName}</span>
                        </div>
                        ${test.status === 'failed' ? `
                            <div class="test-actions">
                                <button class="copy-prompt-icon" onclick="event.stopPropagation(); copyPromptFromTestDetail('full', '${test.num}')" title="Copy Full Prompt">
                                    <span class="material-symbols-outlined">content_copy</span>
                                </button>
                                <button class="copy-prompt-icon" onclick="event.stopPropagation(); copyPromptFromTestDetail('quick', '${test.num}')" title="Copy Quick Prompt">
                                    <span class="material-symbols-outlined">flash_on</span>
                                </button>
                                <button class="copy-prompt-icon" onclick="event.stopPropagation(); copyPromptFromTestDetail('debug', '${test.num}')" title="Copy Debug Prompt">
                                    <span class="material-symbols-outlined">bug_report</span>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            testsList.innerHTML = html;
        }

        // Test Detail Functions
        function showTestDetail(testNum) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show test detail section
            document.getElementById('test-detail-content').classList.add('active');
            
            // Update active navigation state - keep Tests active
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const testsNavItem = document.querySelector(`[onclick="showSection('tests')"]`);
            if (testsNavItem) {
                testsNavItem.classList.add('active');
            }
            
            // Load test detail content
            loadTestDetail(testNum);
            
            // Update URL hash
            window.location.hash = 'test-' + testNum;
            
            // Close mobile sidebar if open
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        function loadTestDetail(testNum) {
            // Open test detail in new window since fetch doesn't work with file:// protocol
            const testDetailUrl = testNum + '/index.html';
            
            // For file:// protocol, just open in new tab
            if (window.location.protocol === 'file:') {
                // Apply media settings to the opened window by passing as query param
                const settings = {
                    hideVideos: !(document.getElementById('setting-videos')?.checked ?? true),
                    hideScreenshots: !(document.getElementById('setting-screenshots')?.checked ?? true)
                };
                const newWindow = window.open(testDetailUrl, '_blank');
                // Note: Can't directly modify the opened page, but could pass settings via URL
                return;
            }
            
            // Fetch the test detail HTML for http/https
            fetch(testDetailUrl)
                .then(response => response.text())
                .then(html => {
                    // Extract the main content from the test detail page
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Get the main content (skip header and navigation)
                    const mainContent = doc.querySelector('.container') || doc.body;
                    
                    // Update the test detail title
                    const testTitle = doc.querySelector('h1')?.textContent || 'Test Details';
                    document.getElementById('test-detail-title').textContent = testTitle;
                    
                    // Clean up the content - remove "Back to Summary" button and other navigation elements
                    let cleanedContent = mainContent.innerHTML;
                    
                    // Remove "Back to Summary" button and similar navigation elements
                    cleanedContent = cleanedContent.replace(/<a[^>]*href="[^"]*summary\.html"[^>]*>.*?<\/a>/gi, '');
                    cleanedContent = cleanedContent.replace(/<button[^>]*onclick="[^"]*summary[^"]*"[^>]*>.*?<\/button>/gi, '');
                    
                    // Remove any navigation links that might interfere
                    cleanedContent = cleanedContent.replace(/<a[^>]*href="[^"]*\/"[^>]*>.*?Back.*?<\/a>/gi, '');
                    
                    // Remove "Back to Summary" button more aggressively (multiline)
                    cleanedContent = cleanedContent.replace(/<a[^>]*>[\s\S]*?Back to Summary[\s\S]*?<\/a>/gi, '');
                    cleanedContent = cleanedContent.replace(/<button[^>]*>[\s\S]*?Back to Summary[\s\S]*?<\/button>/gi, '');
                    
                    // Remove back-link elements (the arrow button) - multiline
                    cleanedContent = cleanedContent.replace(/<a[^>]*class="[^"]*back-link[^"]*"[^>]*>[\s\S]*?<\/a>/gi, '');
                    cleanedContent = cleanedContent.replace(/<a[^>]*class="[^"]*back[^"]*"[^>]*>[\s\S]*?<\/a>/gi, '');
                    
                    // Remove specific back-link structure
                    cleanedContent = cleanedContent.replace(/<a href="\.\.\/summary\.html" class="back-link">[\s\S]*?<\/a>/gi, '');
                    
                    // Remove any remaining "Back to Summary" text
                    cleanedContent = cleanedContent.replace(/Back to Summary/gi, '');
                    
                    // Fix image, video, and attachment paths to include the test folder
                    cleanedContent = cleanedContent.replace(/src="([^"]*\.(png|jpg|jpeg|gif|webm|mp4|md|zip|txt|log))"/gi, `src="${testNum}/$1"`);
                    cleanedContent = cleanedContent.replace(/href="([^"]*\.(png|jpg|jpeg|gif|webm|mp4|md|zip|txt|log))"/gi, `href="${testNum}/$1"`);
                    
                    // Fix Copy Prompt button onclick handlers (only if they exist)
                    cleanedContent = cleanedContent.replace(/onclick="copyPrompt\(([^)]+)\)"/gi, `onclick="copyPromptFromTestDetail($1, '${testNum}')"`);
                    
                    // Check if this is a passing test with minimal content
                    const testElement = doc.querySelector('.test');
                    const hasContent = testElement && testElement.querySelectorAll('.section').length > 1;
                    
                    if (!hasContent) {
                        // This is likely a passing test with minimal content
                        // Add a message indicating it's a passing test
                        cleanedContent = `
                            <div class="test">
                                <header style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 30px;">
                                    <h1 style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; font-size: 1.8rem;">
                                        <span>âœ… Test Passed</span>
                                        <span style="font-size: 1rem; opacity: 0.9;">${testTitle}</span>
                                    </h1>
                                    <div class="test-details" style="display: flex; align-items: center; gap: 20px; font-size: 0.9rem;">
                                        <span>Status: <strong>PASSED</strong></span>
                                        <span>Browser: <strong>rbp-chromium</strong></span>
                                    </div>
                                </header>
                                <section class="section" style="padding: 25px 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem;">
                                        <span class="material-symbols-outlined">check_circle</span>
                                        Test Completed Successfully
                                    </h2>
                                    <p style="line-height: 1.6; color: #555;">
                                        This test passed without any issues. No errors, screenshots, or additional information is available.
                                    </p>
                                </section>
                            </div>
                        `;
                    }
                    
                    // Update the test detail body with cleaned content
                    document.getElementById('test-detail-body').innerHTML = cleanedContent;
                    
                    // Copy CSS styles from the test detail page to ensure proper formatting
                    const testStyles = doc.querySelectorAll('style');
                    testStyles.forEach(style => {
                        if (!document.querySelector(`style[data-test-styles="${testNum}"]`)) {
                            const newStyle = document.createElement('style');
                            newStyle.setAttribute('data-test-styles', testNum);
                            newStyle.textContent = style.textContent;
                            document.head.appendChild(newStyle);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading test detail:', error);
                    document.getElementById('test-detail-body').innerHTML = 
                        '<p>Error loading test details. Please try again.</p>';
                });
        }

        // Copy Prompt function for test details
        function copyPromptFromTestDetail(promptType, testNum) {
            // Get prompt data from the global prompts object
            if (window.testPrompts && window.testPrompts[testNum] && window.testPrompts[testNum][promptType]) {
                const promptData = window.testPrompts[testNum][promptType];
                copyPromptToClipboard(promptData);
            } else {
                showNotification('Prompt data not found for this test.');
            }
        }
        
        function copyPromptToClipboard(promptData) {
            if (promptData) {
                // Copy to clipboard
                navigator.clipboard.writeText(promptData).then(() => {
                    // Show notification
                    showNotification('Prompt copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy prompt:', err);
                    showNotification('Failed to copy prompt. Please try again.');
                });
            } else {
                showNotification('Prompt data not found.');
            }
        }

        // Notification function
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                z-index: 10000;
                font-family: 'Roboto', sans-serif;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Mobile sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Handle URL hash on page load
        function handleHashOnLoad() {
            const hash = window.location.hash.substring(1);
            
            if (hash.startsWith('spec-')) {
                const fileName = decodeURIComponent(hash.substring(5));
                showSpecTests(fileName);
            } else if (hash === 'specs' || hash === 'tests' || hash === 'dashboard' || hash === 'settings') {
                showSection(hash);
            } else if (hash.startsWith('test-')) {
                const testNum = hash.substring(5); // Remove 'test-' prefix
                showTestDetail(testNum);
            } else {
                showSection('dashboard'); // Default to dashboard
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('hashchange', function() {
            const hash = window.location.hash.substring(1);
            
            if (hash.startsWith('spec-')) {
                const fileName = decodeURIComponent(hash.substring(5));
                showSpecTests(fileName);
            } else if (hash === 'specs' || hash === 'tests' || hash === 'dashboard' || hash === 'settings') {
                showSection(hash);
            } else if (hash.startsWith('test-')) {
                const testNum = hash.substring(5); // Remove 'test-' prefix
                showTestDetail(testNum);
            }
        });

        // Settings Functions
        function updateMediaSettings() {
            const showVideos = document.getElementById('setting-videos').checked;
            const showScreenshots = document.getElementById('setting-screenshots').checked;
            
            // Save to localStorage
            localStorage.setItem('specs-reporter-show-videos', showVideos);
            localStorage.setItem('specs-reporter-show-screenshots', showScreenshots);
            
            // Apply settings to test detail body
            applyMediaSettings();
        }
        
        function applyMediaSettings() {
            const testDetailBody = document.getElementById('test-detail-body');
            if (!testDetailBody) return;
            
            const showVideos = document.getElementById('setting-videos')?.checked ?? true;
            const showScreenshots = document.getElementById('setting-screenshots')?.checked ?? true;
            
            // Toggle CSS classes on test detail body
            if (showVideos) {
                testDetailBody.classList.remove('hide-videos');
            } else {
                testDetailBody.classList.add('hide-videos');
            }
            
            if (showScreenshots) {
                testDetailBody.classList.remove('hide-screenshots');
            } else {
                testDetailBody.classList.add('hide-screenshots');
            }
        }
        
        function initializeSettings() {
            // Load saved preferences from localStorage
            const savedVideos = localStorage.getItem('specs-reporter-show-videos');
            const savedScreenshots = localStorage.getItem('specs-reporter-show-screenshots');
            
            // Apply saved preferences or defaults
            const videosCheckbox = document.getElementById('setting-videos');
            const screenshotsCheckbox = document.getElementById('setting-screenshots');
            
            if (videosCheckbox && savedVideos !== null) {
                videosCheckbox.checked = savedVideos === 'true';
            }
            
            if (screenshotsCheckbox && savedScreenshots !== null) {
                screenshotsCheckbox.checked = savedScreenshots === 'true';
            }
            
            // Apply settings on page load
            applyMediaSettings();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            handleHashOnLoad();
            initializeFilters();
            initializeSettings();
            
            // Initialize charts after DOM is ready
            console.log('Initializing charts...');
            initializeCharts();
        });

        // Close mobile sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !mobileMenuBtn.contains(event.target)) {
                sidebar.classList.remove('open');
            }
        });

        // Initialize charts
        function initializeCharts() {
            console.log('initializeCharts function called');
            
            // Check if chart elements exist
            const pieChartElement = document.querySelector("#pieChart");
            const barChartElement = document.querySelector("#barChart");
            
            console.log('Pie chart element:', pieChartElement);
            console.log('Bar chart element:', barChartElement);
            
            if (!pieChartElement || !barChartElement) {
                console.error('Chart elements not found!');
                return;
            }
            
            // Prepare data for ApexCharts - Pie Chart
        var pieChartOptions = {
            chart: {
                type: 'pie',
                height: 300,
            },
            series: [0, 0, 0],
            labels: ['Passed', 'Failed', 'Skipped'],
            colors: ['#27ae60', '#e74c3c', '#f39c12'],
            title: {
                text: 'Test Results Distribution',
                align: 'center'
            }
        };

            // Render the Pie Chart
            console.log('Creating pie chart...');
            var pieChart = new ApexCharts(document.querySelector("#pieChart"), pieChartOptions);
            pieChart.render();
            console.log('Pie chart rendered');

            // Prepare data for ApexCharts - Bar Chart
            var allTests = [];
            
            
            allTests.sort(function(a, b) {
                return b.duration - a.duration;
            });
            
            var top10Tests = allTests.slice(0, 10);

            var barChartOptions = {
                chart: {
                    type: 'bar',
                    height: 300,
                },
                series: [{
                    name: 'Duration (ms)',
                    data: top10Tests.map(function(test) {
                        return test.duration;
                    })
                }],
                xaxis: {
                    categories: top10Tests.map(function(test) {
                        return test.title.length > 30 ? test.title.substring(0, 30) + '...' : test.title;
                    }),
                    labels: {
                        rotate: -45,
                        style: {
                            fontSize: '12px'
                        }
                    }
                },
                title: {
                    text: 'Top 10 Longest Tests',
                    align: 'center'
                }
            };

            // Render the Bar Chart
            console.log('Creating bar chart...');
            var barChart = new ApexCharts(document.querySelector("#barChart"), barChartOptions);
            barChart.render();
            console.log('Bar chart rendered');
            
            // Render Tag Statistics
            renderTagStatistics();
        }
        
        function renderTagStatistics() {
            const tagStatsDiv = document.getElementById('tag-stats');
            if (!tagStatsDiv) return;
            
            // Collect all tags from test data
            const tagCounts = new Map();
            
            Object.values(window.testData.groupedResults).forEach(tests => {
                tests.forEach(test => {
                    if (test.tags && Array.isArray(test.tags)) {
                        test.tags.forEach(tag => {
                            const currentCount = tagCounts.get(tag) || 0;
                            tagCounts.set(tag, currentCount + 1);
                        });
                    }
                });
            });
            
            // Convert to array and sort by count (descending)
            const sortedTags = Array.from(tagCounts.entries())
                .sort((a, b) => b[1] - a[1]);
            
            // Create tag list HTML
            if (sortedTags.length === 0) {
                tagStatsDiv.innerHTML = '<p style="color: #7f8c8d; text-align: center;">No tags found in tests</p>';
                return;
            }
            
            const tagListHTML = '<div class="tag-list">' + 
                sortedTags.map(([tag, count]) => 
                    `<div class="tag-stat-item">
                        <span class="tag-name">@${tag}</span>
                        <span class="tag-count">${count}</span>
                    </div>`
                ).join('') + 
                '</div>';
            
            tagStatsDiv.innerHTML = tagListHTML;
        }
    </script>
</body>
</html>
